# OpenEXR package Makevars
CMAKE = /usr/local/bin/cmake

# Directories
LIBDEFLATE_DIR = /Users/tyler/Desktop/R/libdeflater
INST_DIR = $(LIBDEFLATE_DIR)/inst
LIB_DIR = $(INST_DIR)/lib/arm64/
INCLUDE_DIR = $(INST_DIR)/include
LIBDEFLATE_LIB = $(LIB_DIR)/libdeflate.a

# Set include paths
PKG_CPPFLAGS = -I$(INCLUDE_DIR) -I$(INCLUDE_DIR)/libdeflate

PKG_LIBS = -L$(LIB_DIR) -ldeflate

# Required for linking with static libraries
CFLAGS = $(CFLAGS) $(CPICFLAGS)
CXXFLAGS = $(CXXFLAGS) $(CXXPICFLAGS)

# Main target
all: $(SHLIB)

$(SHLIB): $(LIBDEFLATE_LIB)

$(LIBDEFLATE_LIB):
	cd /Users/tyler/Desktop/R/libdeflater/src/libdeflate/build && /usr/local/bin/cmake --build . --config Release
	cd /Users/tyler/Desktop/R/libdeflater/src/libdeflate/build && /usr/local/bin/cmake --install . --config Release
	mkdir -p /Users/tyler/Desktop/R/libdeflater/inst/lib
	mkdir -p /Users/tyler/Desktop/R/libdeflater/inst/include/libdeflate
	cp /Users/tyler/Desktop/R/libdeflater/inst/lib/arm64/include/*.h /Users/tyler/Desktop/R/libdeflater/inst/include/libdeflate/ 
	cp /Users/tyler/Desktop/R/libdeflater/inst/lib/arm64/lib/*.a $(LIB_DIR)/ 
	-rm -rf /Users/tyler/Desktop/R/libdeflater/inst/lib/arm64/lib
	-rm -rf /Users/tyler/Desktop/R/libdeflater/inst/lib/arm64/bin
	-rm -rf /Users/tyler/Desktop/R/libdeflater/src/libdeflate/build
